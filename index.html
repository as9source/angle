<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>母屋屋根と垂木掛け高さクリアランス計算</title>
<style>
  body { font-family: 'Segoe UI',sans-serif; margin:20px; background:#f8fafc; }
  canvas { border:1px solid #ccc; margin-top:20px; background:#fff; }
  label { display:block; margin-top:8px; }
  input { width:80px; text-align:right; }
  .warn { color:#d97706; font-weight:bold; }
  .error { color:#dc2626; font-weight:bold; }
  .ok { color:#15803d; font-weight:bold; }
</style>
</head>
<body>
<h2>母屋屋根と垂木掛け高さクリアランス計算</h2>

<label>母屋屋根の外壁からの水平寸法 D(mm): <input id="D" value="800"></label>
<label>母屋屋根の高さ Z_h(mm): <input id="Zh" value="300"></label>
<label>垂木掛け高さ Hg(mm): <input id="Hg" value="200"></label>
<label>垂木掛けの厚み(高さ) Hkake(mm): <input id="Hkake" value="67"></label>
<label>サッシ上端の高さ S(mm): <input id="S" value="2100"></label>

<button onclick="draw()">計算・描画</button>

<div id="result"></div>
<canvas id="cv" width="800" height="400"></canvas>

<script>
function draw(){
  const D = +D_.value;
  const Z_h = +Zh.value;
  const Hg = +Hg_.value;
  const Hkake = +Hkake_.value;
  const S = +S_.value;

  const cv = document.getElementById('cv');
  const ctx = cv.getContext('2d');
  ctx.clearRect(0,0,cv.width,cv.height);

  const W = cv.width, H = cv.height, m = 50;
  const scale = 0.1; // mm→pxの縮尺(仮)
  const X = mm => m + mm*scale;
  const Y = mm => H - m - mm*scale;

  // 垂木掛け位置
  const y_HgTop = Y(Hg);
  const y_HgBottom = Y(Hg - Hkake);

  // 垂木ライン（上端）
  const tan10 = Math.tan(10 * Math.PI / 180);
  const z_t = x => Hg + x * tan10; // 上端ライン
  const z_b = x => (Hg - Hkake) + x * tan10; // 下端ライン

  // 描画範囲
  ctx.strokeStyle='#94a3b8';
  ctx.beginPath();
  ctx.moveTo(X(0),Y(0)); ctx.lineTo(X(W),Y(0)); // 軒天
  ctx.moveTo(X(0),Y(0)); ctx.lineTo(X(0),Y(H)); // 外壁
  ctx.stroke();

  // 垂木掛け上端・下端
  ctx.fillStyle="#94a3b8";
  ctx.fillText("垂木掛け", X(10), Y(Hg - Hkake/2));
  ctx.strokeStyle='#0ea5e9';
  ctx.beginPath(); ctx.moveTo(X(0),Y(Hg)); ctx.lineTo(X(D),Y(z_t(D))); ctx.stroke();
  ctx.strokeStyle='#0284c7';
  ctx.beginPath(); ctx.moveTo(X(0),Y(Hg - Hkake)); ctx.lineTo(X(D),Y(z_b(D))); ctx.stroke();

  // 母屋屋根
  ctx.strokeStyle='#facc15';
  ctx.beginPath(); ctx.moveTo(X(0),Y(0)); ctx.lineTo(X(D),Y(Z_h)); ctx.stroke();
  ctx.fillStyle="#713f12"; ctx.fillText("母屋屋根", X(D/2), Y(Z_h)+15);

  // 寸法線・数値
  const drawDim = (x, y1, y2, color, label) => {
    ctx.strokeStyle=color; ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(X(x),Y(y1)); ctx.lineTo(X(x),Y(y2)); ctx.stroke();
    ctx.fillStyle=color;
    ctx.fillText(label, X(x)+8, (Y(y1)+Y(y2))/2);
  };

  // ① サッシ上端→垂木掛け下端
  const diffSash = (Hg - Hkake) - S;
  drawDim(0, S, Hg - Hkake, '#0284c7', `サッシ上端→垂木掛け下端: ${diffSash.toFixed(1)}mm`);

  // ② 母屋屋根↔垂木上端
  const diffMother = Z_h - z_t(D);
  drawDim(D, Z_h, z_t(D), '#facc15', `母屋屋根↔垂木上端: ${diffMother.toFixed(1)}mm`);

  // 判定
  const res = document.getElementById('result');
  res.innerHTML = "";
  if(diffMother < 0){
    res.innerHTML += `<div class="error">⚠ 母屋屋根と垂木が干渉しています (${diffMother.toFixed(1)}mm)</div>`;
  }else if(diffMother < 10){
    res.innerHTML += `<div class="warn">⚠ 母屋屋根と垂木のクリアランス10mm未満（${diffMother.toFixed(1)}mm）</div>`;
  }else{
    res.innerHTML += `<div class="ok">✅ 母屋屋根側クリアランスOK（${diffMother.toFixed(1)}mm）</div>`;
  }

  if(diffSash < 0){
    res.innerHTML += `<div class="error">⚠ サッシ上端より垂木掛け下端が下がっています (${diffSash.toFixed(1)}mm)</div>`;
  }else if(diffSash < 10){
    res.innerHTML += `<div class="warn">⚠ サッシ上端との間隔が10mm未満（${diffSash.toFixed(1)}mm）</div>`;
  }else{
    res.innerHTML += `<div class="ok">✅ サッシ側クリアランスOK（${diffSash.toFixed(1)}mm）</div>`;
  }
}
</script>
</body>
</html>
